{% extends 'base.html.twig' %}

{% block title %}Tableau de bord - Date Parfaite
{% endblock %}

{% block body %}
	<div class="container-tableauBord">
		<div class="logout-container">
			<a href="{{ path('app_logout') }}" class="btn-deconnexion-icon" title="Déconnexion">
				<img src="{{ asset('images/logout.jpg') }}" alt="Déconnexion">
			</a>
		</div>

		{% if app.user %}
			<div class="header">
				<img src="{{ asset('images/DateParfaite.png') }}" alt="Logo" class="logo-tableauBord">
				<h1>Bienvenue
					{{ app.user.prenom }}
					{{ app.user.nom }}</h1>
				<p>{{ app.user.email }}</p>
				<div class="btn-group">
					<a href="{{ path('reunion_new') }}" class="btn btn-planification">Nouvelle planification</a>
				</div>
			</div>

			<h2>Mes Réunions</h2>
			<button class="toggle-btn" onclick="toggleAll()">Afficher / Masquer les réunions</button>

			<div id="reunions-section">
				{% if reunions|length > 0 %}
					{% for reunion in reunions %}
						<div class="reunion-item">
							<div class="reunion-info">
								<h3>{{ reunion.titre }}
									({{ reunion.status.value }})</h3>
								<p>{{ reunion.description }}</p>
								<p>
									<strong>Lieu :</strong>
									{{ reunion.lieu }}</p>
								<p>
									<strong>Créée le :</strong>
									{{ reunion.dateCreation|date('d/m/Y H:i') }}</p>

								<div class="reunion-actions">
									<a href="{{ path('reunion_confirm', { id: reunion.id }) }}" class="btn btn-principal">Confirmer</a>
									<a href="{{ path('reunion_edit', { id: reunion.id }) }}" class="btn btn-secondaire">Modifier</a>
									<a href="{{ path('reunion_choix_creneau', { id: reunion.id }) }}" class="btn btn-secondaire">Valider Un Créneau</a>
									<a href="{{ path('reunion_cancel', { id: reunion.id }) }}" class="btn btn-tertiaire">Annuler</a>
									<a href="{{ path('reunion_archive', { id: reunion.id }) }}" class="btn btn-tertiaire" onclick="return confirm('Voulez-vous vraiment archiver cette réunion ?');">Archiver</a>
								</div>
							</div>

							<div class="reunion-reponses">
								<h4>Invitations et réponses</h4>
								<div class="reponses-scroll">
									<ul class="invitations-list">
										{% for invitation in reunion.invitations %}
											<li class="invitation-item">
												<strong>Email :</strong>
												{{ invitation.inviteEmail }}
												{% if invitation.reponses|length > 0 %}
													<ul class="reponses-list">
														{% for reponse in invitation.reponses %}
															<li class="reponse-item">
																{{ reponse.nom }}
																{{ reponse.prenom }}
																—
																<span class="statut {{ reponse.valider ? 'confirmee' : 'non-confirmee' }}">
																	Confirmée :
																	{{ reponse.valider ? 'Oui' : 'Non' }}
																</span>
																{% if reponse.commentaires %}
																	<div class="commentaire">
																		<em>Commentaire :</em>
																		{{ reponse.commentaires }}</div>
																{% endif %}
																{% if reponse.reponsesCreneauxes|length > 0 %}
																	<div>
																		<strong>Créneaux choisis :</strong>
																	</div>
																	<ul class="creneaux-list">
																		{% for rc in reponse.reponsesCreneauxes %}
																			<li>
																				Du
																				{{ rc.creneaux.startTime|date('d/m/Y : H:i') }}
																				au
																				{{ rc.creneaux.endTime|date('d/m/Y : H:i') }}
																				<strong>Confirmé :</strong>
																				{{ rc.confirmer ? 'Oui' : 'Non' }}
																			</li>
																		{% endfor %}
																	</ul>
																{% else %}
																	<em>Aucun créneau choisi.</em>
																{% endif %}
															</li>
														{% endfor %}
													</ul>
												{% else %}
													<em>Aucune réponse reçue.</em>
												{% endif %}
											</li>
										{% endfor %}
									</ul>
								</div>
								{% if reunion.statsCreneaux is defined %}
									<h4>Statistiques des créneaux (votes)</h4>
									<table class="table">
										<thead>
											<tr>
												<th>Créneau</th>
												<th>Nombre de votes</th>
											</tr>
										</thead>
										<tbody>
											{% for stat in reunion.statsCreneaux %}
												<tr>
													<td>
														Du
														{{ stat.start|date('d/m/Y H:i') }}
														au
														{{ stat.end|date('d/m/Y H:i') }}
													</td>
													<td>{{ stat.count }}</td>
												</tr>
											{% endfor %}
										</tbody>
									</table>
								{% endif %}

							</div>
						</div>
					{% endfor %}
				{% else %}
					<p>Aucune réunion planifiée.</p>
				{% endif %}
			</div>

			{% for message in app.flashes('success') %}
				<div class="alert alert-success">{{ message }}</div>
			{% endfor %}
		{% else %}
			<h1>Veuillez vous connecter pour accéder à votre tableau de bord.</h1>
			<a href="{{ path('app_login') }}">Se connecter</a>
			<p class="mt-3">Pas de compte ?
				<a href="{{ path('app_register') }}">Créer un compte</a>
			</p>
		{% endif %}
	</div>
{% endblock %}

{% block javascripts %}
	<script>
		function toggleAll() {
			const section = document.getElementById('reunions-section');
			section.style.display = section.style.display === 'none' ? 'block' : 'none';
		}
	</script>

{% endblock %}

{% block stylesheets %}{% endblock %}







